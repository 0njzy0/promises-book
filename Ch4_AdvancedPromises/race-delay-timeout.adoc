== Promise.raceとdelayによるXHRのキャンセル

このセクションでは<<promise-race,2章>>で紹介した<<Promise.race,`Promise.race`>>のユースケースとして、
Promise.raceを使ったタイムアウトの実装を学んでいきます。

XHRはもちろん https://developer.mozilla.org/ja/docs/XMLHttpRequest/Synchronous_and_Asynchronous_Requests[timeout] プロパティを持っているので、
これを利用すると簡単に出来ますが、複数のXHRを束ねたタイムアウトや他の機能でも応用が効くため、
分かりやすい非同期処理であるXHRのタイムアウトによるキャンセルを例にしています。

=== Promiseで一定時間待つ

まずはタイムアウトをPromiseでどう実装するかを見て行きたいと思います。

タイムアウトというのは一定時間経ったら何かするという処理なので、`setTimtout`を使えばいいことが分かりますね。

まずは単純に`setTimeout`をPromiseでラップした関数を作ってみましょう。

[source,js]
[[delayPromise.js]]
.delayPromise.js
----
include::embed/embed-delayPromise.js[]
----

`delayPromise(ms)` は引数で指定した時間後にonFulfilledを呼ぶpromiseオブジェクトを返すので、
通常の`setTimeout`を直接使ったものと比較すると以下のように書けるだけの違いです。

[source,js]
----
setTimeout(function () {
    alert("100ms 経ったよ!");
}, 100);
// == ほぼ同様の動作
delayPromise(100).then(function () {
    alert("100ms 経ったよ!");
});
----

ここでは**promiseオブジェクト**であるという事が重要になってくるので覚えておいて下さい。

